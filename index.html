<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<title>Futanium Box 3.0</title>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght@400" rel="stylesheet"/>

<style>
  :root{
    --header:#151823; --bg:#F3F3F3; --card:#FFFFFF; --muted:#9EA3AF; --ink:#0B0F1A;
    --shadow:0 2px 8px rgba(0,0,0,.10);
  }
  *{ box-sizing:border-box; -webkit-tap-highlight-color:transparent }
  html,body{ height:100%; margin:0; overflow:hidden; }
  body{
    background:var(--bg); color:var(--ink);
    font:15px/1.35 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  }
  .app{ position:relative; width:100vw; height:100vh; display:flex; flex-direction:column; }

  .top{
    position:fixed; left:0; right:0; top:0; z-index:1000;
    display:flex; align-items:center; justify-content:space-between;
    height:60px; padding:0 12px; background:#151823; color:#fff;
    box-shadow:0 2px 10px rgba(0,0,0,.35);
  }
  .brand{ font-weight:700; font-size:18px }
  .iconBtn{
    width:46px; height:46px; border:0; background:transparent; color:#fff;
    display:inline-grid; place-items:center; border-radius:50%; cursor:pointer;
  }
  .mi{ font-family:"Material Symbols Outlined"; font-size:26px; }

  .chipWrap{ margin-top:60px; display:flex; justify-content:center; padding:8px 0; }
  .chip{
    display:inline-block; padding:6px 14px; border-radius:12px; background:#fff; color:#555;
    font-weight:700; box-shadow:0 3px 8px rgba(0,0,0,.15);
  }

  /* Player */
  .player-section {
    width: 100%;
    max-width: 95%;
    margin: 0 auto;
    border-radius: 14px;
    overflow: hidden;
    box-shadow: var(--shadow);
    background: #000;
    position: relative;
    aspect-ratio: 16 / 9;
  }
  #playerFrame {
    width: 100%;
    height: 100%;
    border: none;
  }
  .fullscreen-btn {
    position: absolute;
    top: 10px;
    right: 10px;
    background: rgba(0,0,0,0.6);
    color: #fff;
    padding: 6px 12px;
    border-radius: 8px;
    font-size: 14px;
    cursor: pointer;
    user-select: none;
  }
  .player-msg {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: #fff;
    text-align: center;
    font-weight: 600;
    font-size: 18px;
    padding: 0 15px;
  }

  /* Fullscreen */
  .player-section.fullscreen{
    position: fixed;
    inset: 0;
    z-index: 2000;
    border-radius: 0;
    margin: 0;
    max-width: none;
    width: 100vw;
    height: 100vh;
    aspect-ratio: auto;
    background:#000;
  }
  .player-section.fullscreen #playerFrame{
    width: 100%;
    height: 100%;
  }

  /* Botões canais */
  .channels {
    max-width: 95%;
    margin: 12px auto 20px;
    display: flex;
    flex-wrap: wrap;
    gap: 14px;
  }
  .channels button {
    background: #e5e5e5;
    color: #000;
    font-weight: 600;
    border: none;
    border-radius: 10px;
    padding: 12px 20px;
    font-size: 16px;
    cursor: pointer;
    transition: background .2s;
  }
  .channels button:hover { background: #d4d4d4; }

  /* Lista de jogos */
  .list-container {
    flex: 1;
    overflow-y: auto;
    padding: 0 12px 28px;
    margin-top: 20px;
  }
  .card{
    background:var(--card); border-radius:14px; padding:12px; margin-bottom:12px;
    box-shadow:var(--shadow); cursor:pointer;
  }
  .champ{ display:flex; align-items:center; gap:8px; color:var(--muted); font-weight:600; margin-bottom:8px }
  .clogo{ width:24px; height:24px; object-fit:contain }
  .row{ display:flex; align-items:center; justify-content:space-between; gap:8px }
  .team{ width:150px; text-align:center }
  .tlogo{ width:50px; height:50px; object-fit:contain }
  .tname{ margin-top:6px; font-size:12px; min-height:32px }
  .timeBox{ height:50px; display:flex; flex-direction:column; align-items:center; justify-content:center }
  .ttxt{ font-size:20px; font-weight:700; color:#000 }
</style>
</head>
<body>
<div class="app">

  <div class="top">
    <div class="brand">Futanium Web</div>
    <button class="iconBtn" id="btnRefresh"><span class="mi">autorenew</span></button>
  </div>

  <div class="chipWrap"><div class="chip" id="todayChip">JOGOS DE HOJE</div></div>

    <!-- Aviso sobre propagandas -->
  <div style="text-align:center; color:#555; font-weight:500; margin:10px 0;">
    Se aparecer alguma propaganda ao clicar nos jogos ou botões, é só fechar e voltar no site!
  </div>

  <!-- Player -->
  <div class="player-section" id="playerSection">
    <iframe id="playerFrame"
      allow="autoplay; fullscreen; picture-in-picture; encrypted-media"
      allowfullscreen
      referrerpolicy="no-referrer">
    </iframe>
    <div class="player-msg" id="playerMsg">Escolha um jogo para assistir</div>
    <div class="fullscreen-btn" id="fsBtn">Tela cheia</div>
  </div>

  <!-- Botões de canais -->
  <div class="channels" id="channelButtons"></div>

  <!-- Lista de jogos -->
  <div class="list-container" id="list"></div>
</div>

<script type="module">
const API_HTTP = "https://futaniumwebapp.vercel.app/api/games";
const listEl = document.getElementById('list');
const playerFrame = document.getElementById('playerFrame');
const playerSection = document.getElementById('playerSection');
const channelButtons = document.getElementById('channelButtons');
const todayChip = document.getElementById('todayChip');
const fsBtn = document.getElementById('fsBtn');
const playerMsg = document.getElementById('playerMsg');

const MONETAG_URL = "https://otieu.com/4/9902033";

const d=new Date(), dd=('0'+d.getDate()).slice(-2), mm=('0'+(d.getMonth()+1)).slice(-2);
todayChip.textContent = `JOGOS DE HOJE ${dd}/${mm}`;

// Fullscreen
let isFS = false;
fsBtn.onclick = ()=>{
  isFS = !isFS;
  playerSection.classList.toggle('fullscreen', isFS);
  fsBtn.textContent = isFS ? 'Sair' : 'Tela cheia';
  document.documentElement.style.overflow = isFS ? 'hidden' : '';
};

// Render lista
function renderList(items){
  listEl.innerHTML='';
  (items||[]).forEach(it=>{
    const card = document.createElement('div');
    card.className = 'card';
    card.innerHTML = `
      <div class="champ">
        <img class="clogo" src="${it.championship_image_url || ''}">
        <div>${it.championship||''}</div>
      </div>
      <div class="row">
        <div class="team">
          <img class="tlogo" src="${it.home_team_image_url || ''}">
          <div class="tname">${it.home_team||''}</div>
        </div>
        <div class="timeBox"><div class="ttxt">${it.start_time||''}</div></div>
        <div class="team">
          <img class="tlogo" src="${it.visiting_team_image_url || ''}">
          <div class="tname">${it.visiting_team||''}</div>
        </div>
      </div>`;
    card.onclick = ()=>{
      window.open(MONETAG_URL, "_blank"); // ✅ abre anúncio
      selectMatch(it);
    };
    listEl.appendChild(card);
  });
}

// Selecionar jogo
function selectMatch(match){
  const home = match.home_team || '';
  const away = match.visiting_team || '';
  playerMsg.innerHTML = `Escolha um canal para assistir:<br>${home} x ${away}`;

  const buttons = match.buttons || [];
  channelButtons.innerHTML = "";
  if(buttons.length){
    buttons.forEach((btn,i)=>{
      const b = document.createElement("button");
      b.textContent = btn.name || `Canal ${i+1}`;
      b.onclick = ()=>{
        window.open(MONETAG_URL, "_blank"); // ✅ abre anúncio ao clicar no botão
        loadChannel(btn.url);
      };
      channelButtons.appendChild(b);
    });
  }
}

// Carregar canal
function loadChannel(url){
  const sep = url.includes('?') ? '&' : '?';
  const flags = 'autoplay=1&muted=0&volume=1&playsinline=1';
  playerFrame.src = `${url}${sep}${flags}`;
  playerMsg.style.display = "none";
  playerFrame.onload = ()=>{
    try{
      playerFrame.contentWindow.postMessage({type:'unmute'}, '*');
      playerFrame.contentWindow.postMessage({event:'command', func:'unMute'}, '*');
      playerFrame.contentWindow.postMessage({method:'setVolume', value:1}, '*');
    }catch(e){}
  };
}

// Carregar jogos
async function load(){
  const res = await fetch(API_HTTP, {cache:'no-store'});
  const data = await res.json();
  renderList(data);
}
load();
</script>
</body>
</html>